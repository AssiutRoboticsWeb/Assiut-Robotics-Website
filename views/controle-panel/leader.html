<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="stylesheet" href="">

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>leader page</title>
    <style>
        .current-member {
            background-color: rgba(7, 74, 150, 0.356);
            grid-column: 1 / auto auto auto;


        }

        .head {
            grid-area: Area;
            background-color: #00ffff;

            margin: auto;
            width: 200px;
            margin-top: 20px;
            margin-bottom: 20px;
        }
        .members {
            display: grid;
            grid-template-areas: 'Area Area Area Area';
            grid-auto-columns: 300px;
            grid-gap: 30px;
            padding: 20px;
            background-color: cadetblue;

        }

        .members>div {
            text-align: center;
        }

        .tabs {
            background-color: rgb(146, 195, 238);
            width: 1050px;
            margin: auto;
        }

        .tabs>div {
            width: 90px;
            display: inline-block;
            margin: 10px 10px;
            background-color: rgb(95, 146, 240);
        }

        .tabs>div:hover {
            background-color: rgb(32, 96, 216);

            cursor: pointer;
        }
        .current-com{
            position: fixed;
        }
    </style>
</head>

<body>
    <div class="current-com">

    </div>

    <section class="main">
        <div class="tabs">
            <div data-com="new-members">new members</div>
            <div data-com="web">web</div>
            <div data-com="HR">HR</div>
            <div data-com="Marketing">Marketing</div>
            <div data-com="AC machanic">AC mechanic</div>
            <div data-com="AC electric">AC electric</div>
            <div data-com="OC">OC</div>
            <div data-com="PR">PR</div>
            <div data-com="media">media</div>
        </div>

        <div class="members">

        </div>

    </section>




    <script>
        let members;



        const confirm = async (role, id) => {
            try {
                console.log(role);
                console.log(id);

                let data = {
                    token: window.localStorage.getItem("token"),
                    id: id,
                    role: role
                }
                const response = await fetch("../../members/confirm", {
                    method: "post",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                })
                const JSONresponse = await response.json();
                if (response.ok) {
                    console.log(JSONresponse);
                } else {
                    console.log("error", JSONresponse);
                    window.location.href = "../login/login.html";
                }

            } catch (error) {
                console.log(error);
            }
        }

        function addMembersToCurrent(com, member) {
            if (1) {
                document.querySelector(com).innerHTML += `
                <div class="current-member"  data-id="${member._id}">
                <li class="name"> ${member.name} </li>
                <li class="com">${member.committee} </li>
                <li class="email"> ${member.email}</li>
                <li class="phone number"> ${member.phoneNumber}</li>
                <li class="role">${member.role} </li>
                <
                </div>
                `
            }


        }


        const changeHead = async (com, head_id) => {
            document.querySelector(".main").style.opacity = '0.1';
            document.querySelector(".current-com").style.opacity = '1';
            console.log(com);
            console.log(head_id);
            members.forEach(member => {
                if (member.committee == com && member.role <= 4) {
                    console.log(12);
                    addMembersToCurrent(".current-com", member)
                }
            });
            console.log("after for each member");
            const current_members = Array.from(document.querySelectorAll(".current-com .member"));
            console.log("after current");
            // console.log(current_members.length);
            current_members.forEach(element => {

                element.addEventListener("click", async (event) => {


                    try {
                        // console.log(role);
                        // console.log(id);
                        let data = {
                            token: window.localStorage.getItem("token"),
                            old_id: head_id,
                            new_id: element.dataset.id
                        }
                        console.log(data);
                        const response = await fetch("../../members/changeHead", {
                            method: "post",
                            headers: {
                                "Content-Type": "application/json"
                            },
                            body: JSON.stringify(data)
                        })
                        const JSONresponse = await response.json();
                        if (response.ok) {
                            console.log(JSONresponse);
                        } else {
                            console.log("error", JSONresponse);
                            window.location.href = "../login/login.html";

                        }

                    } catch (error) {
                        console.log(error);
                    }
                })
            });

        }


        function addMembersToCommittee(com, member) {
            if (member.role == 2) {
                document.querySelector(".members").innerHTML += `
                <div class="head">
                <li class="name"> head ${member.name} </li>
                <li class="com">${member.committee} </li>
                <li class="email"> ${member.email}</li>
                <li class="phone number"> ${member.phoneNumber}</li>
                <li class="role">${member.role} </li>
                <button  onclick="changeHead(dataset.com,dataset.id)" data-id="${member._id}" data-com="${member.committee}"> change head</button>
                </div>

                `
            }
            else if (member.role == 5) {
                document.querySelector(com).innerHTML += `
                <div class="member">
                <li class="name">name: ${member.name} </li>
                <li class="com">${member.committee} </li>
                <li class="email"> ${member.email}</li>
                <li class="phone number">phoneNumber ${member.phoneNumber}</li>
                <li class="role">${member.role} </li>
                
                <button  onclick="confirm(4,dataset.id)" data-id="${member._id}"> accept</button>
                <button onclick="confirm(0,dataset.id)" data-id="${member._id}"> remove</button>

                </div>
                
            `

            }
            else {

                document.querySelector(com).innerHTML += `
                <div class="member">
                <li class="name"> ${member.name} </li>
                <li class="com">${member.committee} </li>
                <li class="email"> ${member.email}</li>
                <li class="phone number"> ${member.phoneNumber}</li>
                <li class="role">${member.role} </li>
                
                <button onclick="confirm(0,dataset.id)" data-id="${member._id}"> remove</button>
                </div>
                
            `
            }
        }


        onload = async function () {
            //https://assiut-robotics-website.onrender.com/
            //http://localhost:3000/
            const res = await fetch("../../members/getAllMembers");
            if (res.ok) {
                const response = await res.json();
                members = response.data.members;

            }

        }

        const tabs = Array.from(document.querySelectorAll('.tabs>div'));
        function clearTabs() {
            tabs.forEach(tab => {
                tab.style = `background-color: rgb(95, 146, 240);`
            })
        }

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                clearTabs();
                tab.style = `background-color: rgb(32, 96, 216);`
                document.querySelector('.members').innerHTML = '';
                console.log(tab.dataset.com);
                members.forEach(member => {
                    if (member.committee == tab.dataset.com && member.role < 5) {
                        addMembersToCommittee('.members', member)

                    }

                    if (tab.dataset.com == 'new-members' && member.role == 5) {
                        addMembersToCommittee('.members', member)

                    }

                });
            })
        });






        // draft
        // < button onclick = "confirm(4,dataset.id)" data - id="${item._id}" > accept </button >
        //<button onclick="confirm(3,dataset.id)" data-id="${item._id}"> make it head </button>
        //<button onclick="confirm(2,dataset.id)" data-id="${item._id}"> make it admin  </button>
        //<button onclick="confirm(0,dataset.id)" data-id="${item._id}"> remove</button>
    </script>
</body>

</html>