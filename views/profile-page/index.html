<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>profile page</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
        integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- font awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="shortcut icon" href="../all-images/logo.ico" />
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;400;600&family=Roboto+Condensed:wght@300&display=swap"
        rel="stylesheet">
</head onload="load()">

<body>


    <nav id="nav">
        <div class="container">
            <a href="../index.html" class="control-buttons">
                <img id="logo" src="../all-images/logo.png">
            </a>
            <i onclick="toggleNavBar()" id="nav-bar-phone" class="fa-solid fa-bars"></i>
            <!--  phone-respons-->
            <div id="toggleNav" class="control-buttons-div ">
                <a id="control-panel" href="../control-panel/leader.html" class="control-buttons"> control page</a>
                <a id="OC-page1" href="../OC_page/OC.html" class="control-buttons">component page 1</a>
                <a id="OC-page2" href="../OC_page/component.html" class="control-buttons">component page 2</a>
                <a id="addComponent" href="../OC_page/upload_component.html"
                    class="control-buttons">upload_component</a>
                <a id="blog-page" href="../blog/add-blog.html" class="control-buttons">Add blog</a>
                <a id="head-hr" href="../control-panel/addHrTocommittee.html" class="control-buttons">make hr admin</a>
                <button class="logout-button" onclick="logout()">LOG OUT</button>

            </div>
        </div>

    </nav>



    <div class="container-main">

        <div class="content">
            <div class="left">
                <img id="human" src="../all-images/human.png" alt="notfound">
                <div class="info">
                    <h2 id="nameHuman">Hembo Tingor</h2>
                    <p id="specialty">Web Designer</p>
                    <form name="profile_pic" enctype="multipart/form-data">
                        <input type="file" name="image" id="changePhoto" class="disabled">
                        <input type="hidden" name="token" class="disabled">
                        <label for="changePhoto"><i class="fa-regular fa-pen-to-square"></i></label>
                    </form>
                </div>
            </div>

            <div class="right">
                <p class="title bolding">Information</p>
                <hr />
                <div class="contact">
                    <div>
                        <p class="bolding">Email</p>
                        <p id="email">mfng@gmail.com</p>
                    </div>
                    <div>
                        <p class="bolding">Phone</p>
                        <p id="phone">98764512398</p>
                    </div>
                    <!-- <div class="titles">
                        
                        
                    </div>
                    <div class="infoo">
                        
                        
                    </div> -->
                </div>
                <p class="title bolding">Achievements</p>
                <hr />
                <div class="contact">
                    <div>
                        <p class="bolding">Rating</p>
                        <div class="rate-cards">
                            <div onclick="showpop3()" class="card" data-importance="3">
                                <div id="popup3" class="popup">
                                    <div class="popup-text">
                                        <p>
                                            3 everything is good
                                        </p>
                                    </div>
                                </div>

                                <div class="circular-progress" data-percentage="80" data-progress-color="#2aa9f3"
                                    data-bg-color="white">
                                    <div class="inner-circle"></div>
                                    <p class="percentage">80%</p>
                                </div>
                                <p class="month">October</p>
                                <p onclick="showpop3()" class="more">MORE...</p>
                            </div>
                            <div onclick="showpop2()" class="card" data-importance="2">
                                <div id="popup2" class="popup">
                                    <div class="popup-text">
                                        <p>
                                            2 everything is good
                                        </p>
                                    </div>
                                </div>
                                <div class="circular-progress" data-percentage="70" data-progress-color="#2aa9f3"
                                    data-bg-color="white">
                                    <div class="inner-circle"></div>
                                    <p class="percentage">70%</p>
                                </div>
                                <p class="month">September</p>
                                <p onclick="showpop2()" class="more">MORE...</p>
                            </div>
                            <div class="card" data-importance="1">
                                <div id="popup1" class="popup">
                                    <div class="popup-text">
                                        <p>
                                            1 everything is good
                                        </p>
                                    </div>
                                </div>
                                <div class="circular-progress" data-percentage="60" data-progress-color="#2aa9f3"
                                    data-bg-color="white">
                                    <div class="inner-circle"></div>
                                    <p class="percentage">60%</p>
                                </div>
                                <p class="month">August</p>
                                <p onclick="showpop1()" class="more">MORE...</p>
                            </div>
                        </div>
                    </div>
                    <div>
                        <p class="bolding">Warnings</p>
                        <p>Dinoter husainm</p>
                    </div>
                </div>
                <!-- <div class="works">
                    <div class="titles">
                        <p class="bolding">Recent</p>
                        <p class="bolding right">Most Viewed</p>
                    </div>
                    <div class="infoo">
                        <p>Sam Dissuja</p>
                        <p class="right">Dinoter husainm</p>
                    </div>
                </div> -->
                <p class="title bolding">Technical</p>
                <hr />
                <div class="contact">
                    <div>
                        <p>Electrical</p>
                    </div>
                    <div>
                        <p>Mechanical</p>
                    </div>
                </div>
                <div class="social">
                    <i class="fa-brands fa-facebook-f"></i>
                    <i class="fa-brands fa-twitter"></i>
                    <i class="fa-brands fa-instagram"></i>
                </div>
            </div>
        </div>
    </div>

    <script src="main.js"></script>
    <script>
        let id;
        const load = async () => {
            let token = window.localStorage.getItem("token");
            console.log(token);
            let data = {
                token,
            }
            if (token) {
                let response = await fetch("https://assiutrobotics-production.up.railway.app/members/verify", {
                    method: "post",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data),
                });

                if (!response.ok) {

                    window.location.href = "../login/login.html"
                } else {
                    const JSONresponse = await response.json();
                    console.log(JSONresponse);
                    id = JSONresponse.data.id;
                    edit()
                    if (JSONresponse.data.role < 4) {
                        document.getElementById('control-panel').style.display = "flex";
                    }
                    if ((JSONresponse.data.committee == "HR" && JSONresponse.data.role < 4) || JSONresponse.data.role == 1) {
                        document.getElementById('head-hr').style.display = "inline-block";
                        document.getElementById('OC-page1').style.display = "inline-block";
                        document.getElementById('OC-page2').style.display = "inline-block";
                        document.getElementById('blog-page').style.display = "inline-block";
                        document.getElementById('addComponent').style.display = "inline-block";


                    }
                    if (JSONresponse.data.committee == "OC") {
                        document.getElementById('OC-page1').style.display = "flex";
                        document.getElementById('OC-page2').style.display = "flex";
                        document.getElementById('addComponent').style.display = "flex";
                    }
                    if (JSONresponse.data.committee == "media") {
                        document.getElementById('blog-page').style.display = "flex";
                    }
                    document.getElementById("nameHuman").innerHTML = JSONresponse.data.name;
                    document.getElementById("email").innerHTML = JSONresponse.data.email;
                    document.getElementById("phone").innerHTML = JSONresponse.data.phoneNumber;
                    document.getElementById("specialty").innerHTML = JSONresponse.data.committee;
                    document.getElementById("human").src = `../../uploads/${JSONresponse.data.avatar}`;
                    window.localStorage.setItem("role", JSONresponse.data.role);
                    window.localStorage.setItem("committee", JSONresponse.data.committee);
                }
            } else {
                // window.location.href = "../login/login.html"

            }


        }

        const logout = () => {
            window.localStorage.removeItem("token");
            document.querySelector(".container").style.display = "none";
            window.alert("نورتنا  (: ")
            window.location.href = "../"
        }


        function edit() {
            let field = document.getElementById("changePhoto");

            field.addEventListener("change", (e) => {
                let form = document.forms["profile_pic"];
                form["token"].value = window.localStorage.getItem("token");
                console.log(form["token"].value);
                let body = new FormData(form);


                // let obj = {
                //     token: token,
                //     // ID: id,
                //     file: e.target.files[0]
                // }     
                // console.log(obj); // token : token, ID: undefined, file: File

                fetch("https://assiutrobotics-production.up.railway.app/members/changeProfileImage", {
                    method: "POST",
                    // headers: {
                    //     "Content-Type": "application/json"
                    // },
                    body: body
                }).then(res => res.json()).then(data => {
                    console.log(data);
                }).catch(err => {
                    console.log(err);
                })
            })
        }

        // for rating section
        const circularProgress = document.querySelectorAll(".circular-progress");
        Array.from(circularProgress).forEach((progressBar) => {
            const progressValue = progressBar.querySelector(".percentage");
            const innerCircle = progressBar.querySelector(".inner-circle");
            let startValue = 0,
                endValue = Number(progressBar.getAttribute("data-percentage")),
                speed = 50,
                progressColor = progressBar.getAttribute("data-progress-color");

            const progress = setInterval(() => {
                startValue++;
                progressValue.textContent = `${startValue}%`;
                progressValue.style.color = `${progressColor}`;

                progressBar.style.background = `conic-gradient(${progressColor} ${startValue * 3.6
                    }deg,${progressBar.getAttribute("data-bg-color")} 0deg)`;
                if (startValue === endValue) {
                    clearInterval(progress);
                }
            }, speed);
        });
    </script>


</body>

</html>